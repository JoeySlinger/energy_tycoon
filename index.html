<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Energy Tycoon: Ages of Power</title>
    <style>
        :root {
            --grid-bg: #2e3235;
            --panel-bg: rgba(20, 22, 25, 0.98);
            --accent: #ffae00;
            --money-green: #4ade80;
            --panel-border: #4a4e52;
            --shadow-dark: rgba(0,0,0,0.8);
            --btn-disabled: #333;
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Courier New', Courier, monospace;
            color: #eee;
            background-color: #1a1c1e;
            background-attachment: fixed;
            image-rendering: pixelated;
            transition: background 0.8s ease;
            display: flex; flex-direction: column; height: 100vh;
            overflow: hidden; 
        }

        /* BACKGROUND TIER LOGIC */
        body[data-tier="1"] { background: url('assets/texture1.jpg') repeat; --accent: #ffae00; }
        body[data-tier="2"] { background: url('assets/texture2.jpg') repeat; --accent: #00f2ff; }
        body[data-tier="3"] { background: url('assets/texture3.jpg') repeat; --accent: #bd00ff; }
        body[data-tier="4"] { background: url('assets/texture4.jpg') repeat; --accent: #ff0055; }

        .dashboard-header {
            display: flex; flex-direction: column; align-items: center;
            padding: 10px 0; background: rgba(0,0,0,0.7); border-bottom: 3px solid #000;
        }

        .main-logo {
            max-width: 180px; width: 45%; height: auto; max-height: 75px; margin-bottom: 5px;
            filter: drop-shadow(1px 0 0 #2e3235) drop-shadow(-1px 0 0 #2e3235) drop-shadow(0 1px 0 #2e3235) drop-shadow(0 -1px 0 #2e3235);
        }

        .stats-pill {
            display: flex; align-items: center; justify-content: center; gap: 15px; 
            background: #000; padding: 8px 25px; border: 2px solid var(--panel-border); 
            border-radius: 50px; box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            width: fit-content; margin: 0 auto;
        }

        .stat-item { font-size: 1.1rem; font-weight: bold; white-space: nowrap; }
        .stat-item.money { color: var(--money-green); }
        .stat-item.power { color: var(--accent); }

        .tab-menu { margin-top: 8px; display: flex; gap: 5px; }
        .pixel-btn {
            background: #444; border: none; color: #fff; padding: 12px 16px;
            cursor: pointer; font-family: inherit; font-weight: bold; text-transform: uppercase;
            box-shadow: inset 3px 3px 0 rgba(255,255,255,0.05), inset -3px -3px 0 var(--shadow-dark), 3px 3px 0 #000;
            display: block; width: 100%;
        }
        .pixel-btn:active:not(:disabled) { transform: translate(1px, 1px); box-shadow: inset 2px 2px 0 #000; }
        .pixel-btn.active { background: var(--accent); color: #000; }
        .pixel-btn:disabled { background: var(--btn-disabled); color: #666; cursor: not-allowed; }

        /* CENTERED RESPONSIVE STAGE */
        #main-stage {
            flex: 1; display: flex; flex-direction: row; flex-wrap: wrap;
            justify-content: center; align-items: flex-start;
            gap: 20px; padding: 15px; width: 100%; box-sizing: border-box;
        }

        #grid-frame { background: #000; padding: 8px; border: 3px solid #333; box-shadow: 4px 4px 0 rgba(0,0,0,0.5); }
        #grid { display: grid; grid-template-columns: repeat(6, 50px); grid-template-rows: repeat(6, 50px); gap: 4px; }

        @media (max-width: 700px) {
            #main-stage { flex-direction: column; align-items: center; padding: 10px; }
            #grid { grid-template-columns: repeat(6, 14vw); grid-template-rows: repeat(6, 14vw); max-width: 90vw; }
            #grid-frame { width: fit-content; margin: 0 auto; }
            #console-panel { width: 92vw !important; margin: 0 auto; height: auto !important; min-height: 420px; }
        }

        .cell { background: #2e3235; border: 1px solid #444; position: relative; cursor: pointer; }
        .cell.selected { border: 2px solid var(--accent); box-shadow: inset 0 0 8px var(--accent); }
        .cell img { width: 85%; height: 85%; object-fit: contain; display: block; margin: 7.5% auto; }
        .lv-tag { position: absolute; bottom: 1px; right: 1px; font-size: 7px; background: #000; color: var(--accent); padding: 0 2px; }

        #console-panel {
            width: 360px; height: 480px; background: var(--panel-bg);
            border: 4px solid var(--panel-border); box-shadow: 4px 4px 0 rgba(0,0,0,0.5);
            display: flex; flex-direction: column; overflow: hidden;
        }

        .panel-header { background: #111; padding: 10px; border-bottom: 2px solid #444; font-weight: bold; text-align: center; color: var(--accent); font-size: 1.1rem; }
        .scroll-area { flex: 1; overflow-y: auto; padding: 12px; }

        .data-row { display: flex; justify-content: space-between; margin-bottom: 8px; padding-bottom: 4px; border-bottom: 1px solid #333; }
        .data-label { color: #888; font-size: 0.85rem; }

        .action-footer {
            background: #15171a; border-top: 3px solid #000;
            padding: 12px; display: grid; grid-template-columns: 1fr; gap: 10px;
        }

        .funny-sub { font-size: 0.75rem; color: #777; font-style: italic; display: block; margin-top: 4px; line-height: 1.2; }

        #footer-news { height: 35px; background: #000; border-top: 2px solid #333; overflow: hidden; line-height: 35px; font-size: 1rem; }
        #ticker-text { display: inline-block; white-space: nowrap; padding-left: 100%; animation: ticker 25s linear infinite; color: var(--accent); font-weight: bold; }
        @keyframes ticker { 0% { transform: translate(0, 0); } 100% { transform: translate(-150%, 0); } }

        .hidden { display: none !important; }
    </style>
</head>
<body data-tier="1">

<header class="dashboard-header">
    <img id="logo" src="assets/logo1.png" class="main-logo">
    <div class="stats-pill">
        <div class="stat-item money">ðŸ’µ <span id="money">0</span></div>
        <div class="stat-item power">âš¡ <span id="pps">0</span></div>
        <div id="mute-toggle" onclick="toggleMute()" style="cursor:pointer; font-size: 1.2rem;">ðŸ”Š</div>
    </div>
    <nav class="tab-menu">
        <button id="tab-grid-btn" class="pixel-btn active" onclick="showTab('grid')">Energy Grid</button>
        <button id="tab-tech-btn" class="pixel-btn" onclick="showTab('tech')">Technology</button>
    </nav>
</header>

<main id="main-stage">
    <div id="grid-view" style="display: contents;">
        <div id="grid-frame"><div id="grid"></div></div>
        <div id="console-panel">
            <div class="panel-header" id="panel-title">System Console</div>
            <div class="scroll-area" id="console-content">
                <div id="ins-welcome" style="text-align: center; padding-top: 50px; color: #666;">
                    <p>TAP A GRID SECTOR</p>
                </div>
                <div id="ins-shop" class="hidden"><div id="shop-items"></div></div>
                <div id="ins-manage" class="hidden">
                    <img id="ins-img" style="width:70px; height:70px; display:block; margin: 0 auto 10px; border:2px solid #444; background:#222;">
                    <div class="data-row"><span class="data-label">Unit:</span><span class="data-value" id="ins-name" style="color:var(--accent)"></span></div>
                    <div class="data-row"><span class="data-label">Level:</span><span class="data-value" id="ins-lv"></span></div>
                    <div class="data-row"><span class="data-label">Yield:</span><span class="data-value" id="ins-out"></span></div>
                </div>
                <div id="ins-away" class="hidden">
                    <h3 style="color:var(--money-green); text-align:center;">OFFLINE RECOVERY</h3>
                    <div class="data-row"><span class="data-label">Away Time:</span><span class="data-value" id="away-time"></span></div>
                    <div class="data-row"><span class="data-label">Generated:</span><span class="data-value" id="away-cash" style="color:var(--money-green)"></span></div>
                </div>
            </div>
            <div id="console-actions" class="action-footer hidden">
                <button id="btn-upgrade" class="pixel-btn" onclick="upgradeSelected()">Upgrade Unit</button>
                <button id="btn-deconstruct" class="pixel-btn" style="background:#822;" onclick="deconstructSelected()">Deconstruct</button>
                <button id="btn-away-close" class="pixel-btn hidden" onclick="acknowledgeAway()">Acknowledge</button>
            </div>
        </div>
    </div>
    <div id="tech-view" class="hidden">
        <div id="console-panel" style="width: 500px; height: 480px;">
            <div class="panel-header">Mad Technology Laboratory</div>
            <div class="scroll-area" id="tech-container"></div>
        </div>
    </div>
</main>

<footer id="footer-news"><div id="ticker-text">... BOOTING MAD SCIENCE INTERFACE ...</div></footer>

<script>
    const PLANTS = [
        { id: 0, name: "Rusty Coal Reactor", cost: 250, prod: 1, img: "rusty-coal.jpg", tier: 1, rarity: 1 },
        { id: 1, name: "Heavy Combustion Gen", cost: 2250, prod: 8, img: "combustion_generator.jpg", tier: 1, rarity: 2 },
        { id: 2, name: "Fission Power Plant", cost: 15000, prod: 55, img: "fission_power.jpg", tier: 1, rarity: 3 },
        { id: 3, name: "Advanced Renewables", cost: 100000, prod: 250, img: "renewables.jpg", tier: 1, rarity: 4 },
        { id: 4, name: "Tokamak Fusion", cost: 600000, prod: 1500, img: "fusion.jpg", tier: 2, rarity: 5 },
        { id: 5, name: "Zero-Point Module", cost: 5000000, prod: 10000, img: "zero-point.jpg", tier: 2, rarity: 6 },
        { id: 6, name: "Antimatter Unit", cost: 40000000, prod: 60000, img: "antimatter.jpg", tier: 2, rarity: 7 },
        { id: 7, name: "Orbital Satellite", cost: 250000000, prod: 450000, img: "solar.jpg", tier: 3, rarity: 8 },
        { id: 8, name: "Star Lifter", cost: 3000000000, prod: 5000000, img: "star_station.jpg", tier: 3, rarity: 9 },
        { id: 9, name: "Dyson Sphere", cost: 75000000000, prod: 100000000, img: "dyson.jpg", tier: 3, rarity: 10 },
        { id: 10, name: "Substation", cost: 20000, prod: 0, img: "substation.jpg", tier: 1, isSpecial: true, rarity: 1 },
        { id: 11, name: "Gravitational Siphon", cost: 500000000000, prod: 800000000, img: "gravitational_siphon.jpg", tier: 4, rarity: 15 },
        { id: 12, name: "Singularity Extractor", cost: 2500000000000, prod: 4500000000, img: "singularity_extractor.jpg", tier: 4, rarity: 20 },
        { id: 13, name: "Event Horizon Refinery", cost: 15000000000000, prod: 12000000000, img: "event_horizon_refinery.jpg", tier: 4, rarity: 25 },
        { id: 14, name: "Hawking Harvester", cost: 80000000000000, prod: 35000000000, img: "hawking_radiation_harvester.jpg", tier: 4, rarity: 30 },
        { id: 15, name: "Cosmic Void Converter", cost: 500000000000000, prod: 150000000000, img: "void_converter.jpg", tier: 4, rarity: 50 }
    ];

    let state = { money: 1000, tier: 1, grid: Array(36).fill(null), selectedIdx: null, tech: { gridLv: 0, interns: 0, tax: 0, caffeine: 0, bribe: 0, greenwash: 0, spag: 0, substationUnlocked: false }, mute: false, lastSaved: Date.now() };
    const sounds = { buy: new Audio('assets/buy.mp3'), hum: new Audio('assets/hum.mp3') };
    sounds.hum.loop = true;

    function format(num, isPower = false) {
        if (num === 0) return "0";
        const prefixes = isPower ? ['', 'k', 'M', 'G', 'T', 'P', 'E'] : ['', 'K', 'M', 'B', 'T', 'Q', 'Qi'];
        const suffix = isPower ? 'W' : '';
        const i = Math.floor(Math.log10(Math.abs(num)) / 3);
        if (i <= 0) return Math.floor(num) + suffix;
        return (num / Math.pow(1000, i)).toFixed(2).replace(/\.00$/, '') + prefixes[i] + suffix;
    }

    window.onload = () => {
        const saved = localStorage.getItem('energyTycoon_MadScience_v1');
        if (saved) { state = JSON.parse(saved); calculateOfflineEarnings(); }
        createGrid(); renderGrid(); updateUI();
        setInterval(gameLoop, 100);
        setInterval(saveGame, 5000);
    };

    function saveGame() { state.lastSaved = Date.now(); localStorage.setItem('energyTycoon_MadScience_v1', JSON.stringify(state)); }

    function calculateOfflineEarnings() {
        const now = Date.now();
        const secondsAway = Math.floor((now - state.lastSaved) / 1000);
        if (secondsAway < 60) return;
        let totalPPS = 0;
        state.grid.forEach(c => { if(c && !PLANTS[c.id].isSpecial) totalPPS += (PLANTS[c.id].prod * Math.pow(2, c.level - 1)); });
        const generation = totalPPS * (1 + state.tech.gridLv * 0.1) * (1 + state.tech.interns * 0.05);
        const earned = (generation * secondsAway) * (1 + state.tech.tax * 0.1 + state.tech.greenwash * 0.05);
        state.money += earned;
        showAwayReport(secondsAway, earned);
    }

    function showAwayReport(time, cash) {
        document.getElementById('ins-welcome').classList.add('hidden');
        document.getElementById('ins-away').classList.remove('hidden');
        document.getElementById('console-actions').classList.remove('hidden');
        document.getElementById('btn-away-close').classList.remove('hidden');
        document.getElementById('btn-upgrade').classList.add('hidden');
        document.getElementById('btn-deconstruct').classList.add('hidden');
        document.getElementById('away-time').innerText = Math.floor(time/60) + "m";
        document.getElementById('away-cash').innerText = "$" + format(cash);
    }

    function acknowledgeAway() {
        document.getElementById('ins-away').classList.add('hidden');
        document.getElementById('btn-away-close').classList.add('hidden');
        document.getElementById('ins-welcome').classList.remove('hidden');
        document.getElementById('console-actions').classList.add('hidden');
    }

    function createGrid() {
        const g = document.getElementById('grid'); g.innerHTML = '';
        for (let i = 0; i < 36; i++) {
            const c = document.createElement('div'); c.className = 'cell'; c.id = `cell-${i}`;
            c.onclick = () => selectCell(i);
            g.appendChild(c);
        }
    }

    function selectCell(idx) {
        state.selectedIdx = idx; renderGrid();
        document.getElementById('ins-welcome').classList.add('hidden');
        document.getElementById('ins-away').classList.add('hidden');
        const footer = document.getElementById('console-actions');

        if (!state.grid[idx]) {
            document.getElementById('ins-manage').classList.add('hidden');
            footer.classList.add('hidden');
            document.getElementById('ins-shop').classList.remove('hidden');
            renderShop();
        } else {
            document.getElementById('ins-shop').classList.add('hidden');
            document.getElementById('ins-manage').classList.remove('hidden');
            footer.classList.remove('hidden');
            document.getElementById('btn-away-close').classList.add('hidden');
            document.getElementById('btn-upgrade').classList.remove('hidden');
            document.getElementById('btn-deconstruct').classList.remove('hidden');
            const p = PLANTS[state.grid[idx].id];
            document.getElementById('ins-name').innerText = p.name;
            document.getElementById('ins-img').src = `assets/${p.img}`;
            document.getElementById('btn-upgrade').classList.toggle('hidden', !!p.isSpecial);
            updateInspector();
        }
    }

    function renderShop() {
        const cont = document.getElementById('shop-items'); cont.innerHTML = '';
        PLANTS.filter(p => p.tier <= state.tier && (p.id !== 10 || state.tech.substationUnlocked)).forEach(p => {
            const b = document.createElement('button'); b.className = 'pixel-btn'; b.style.marginBottom = "5px";
            b.innerHTML = `<div style="display:flex; justify-content:space-between"><span>${p.name}</span> <span>$${format(p.cost)}</span></div>`;
            b.dataset.id = p.id;
            b.onclick = () => { if(state.money >= p.cost) { state.money -= p.cost; state.grid[state.selectedIdx] = { id: p.id, level: 1 }; playSound('buy'); selectCell(state.selectedIdx); }};
            cont.appendChild(b);
        });
    }

    function updateInspector() {
        const data = state.grid[state.selectedIdx]; if (!data) return;
        const p = PLANTS[data.id];
        const rarityMult = 1.5 + (p.rarity / 100);
        const upCost = Math.floor(p.cost * Math.pow(rarityMult, data.level));
        const out = Math.floor(p.prod * Math.pow(2, data.level - 1));
        document.getElementById('ins-lv').innerText = p.isSpecial ? "STATIC" : `${data.level}/10`;
        document.getElementById('ins-out').innerText = p.isSpecial ? "PASSIVE" : `${format(out, true)}`;
        const b = document.getElementById('btn-upgrade');
        if (!p.isSpecial) {
            b.disabled = state.money < upCost || data.level >= 10;
            b.innerHTML = data.level >= 10 ? "MAXED" : `UPGRADE ($${format(upCost)})`;
        }
    }

    function gameLoop() {
        let total = 0;
        state.grid.forEach((c) => { if(c && !PLANTS[c.id].isSpecial) total += (PLANTS[c.id].prod * Math.pow(2, c.level - 1)); });
        const generation = total * (1 + state.tech.gridLv * 0.1) * (1 + state.tech.interns * 0.05) * (1 + state.tech.caffeine * 0.1);
        const cashMult = 1 + (state.tech.tax * 0.1) + (state.tech.bribe * 0.05) + (state.tech.greenwash * 0.05);
        state.money += (generation / 10) * cashMult;
        document.getElementById('money').innerText = format(state.money);
        document.getElementById('pps').innerText = format(generation, true);
        
        if (!document.getElementById('ins-shop').classList.contains('hidden')) {
            document.querySelectorAll('#shop-items .pixel-btn').forEach(b => b.disabled = state.money < PLANTS[b.dataset.id].cost);
        }
        if (!document.getElementById('ins-manage').classList.contains('hidden')) updateInspector();
        if (document.getElementById('tech-view').offsetParent) {
            document.querySelectorAll('#tech-container button').forEach(b => { b.disabled = state.money < parseInt(b.dataset.cost); });
        }
        if (generation > 0 && !state.mute) { if(sounds.hum.paused) sounds.hum.play(); sounds.hum.volume = 0.1; } else sounds.hum.pause();
    }

    function renderGrid() {
        for (let i = 0; i < 36; i++) {
            const c = document.getElementById(`cell-${i}`);
            c.className = 'cell' + (state.selectedIdx === i ? ' selected' : '');
            if(state.grid[i]) {
                const p = PLANTS[state.grid[i].id];
                c.innerHTML = `<img src="assets/${p.img}"><div class="lv-tag">${p.isSpecial ? 'SPEC' : 'Lv'+state.grid[i].level}</div>`;
            } else c.innerHTML = '';
        }
    }

    function showTab(t) {
        document.getElementById('grid-view').style.display = (t==='grid'?'contents':'none');
        document.getElementById('tech-view').classList.toggle('hidden', t!=='tech');
        document.getElementById('tab-grid-btn').classList.toggle('active', t==='grid');
        document.getElementById('tab-tech-btn').classList.toggle('active', t==='tech');
        if (t === 'tech') renderTech();
    }

    function renderTech() {
        const cont = document.getElementById('tech-container'); cont.innerHTML = '';
        if (state.tier < 4) {
            const cost = 250000 * Math.pow(4, state.tier - 1);
            createTech(cont, "EVOLVE AGE", cost, "Change the wallpaper and bankrupt your planet.", () => { state.tier++; updateUI(); });
        }
        if (!state.tech.substationUnlocked) createTech(cont, "UNLOCK SUBSTATIONS", 100000, "Engineering for the elite.", () => state.tech.substationUnlocked = true);
        
        createTech(cont, "INTERN TREADMILLS", 5000 * Math.pow(3, state.tech.interns), "Digital labor is free power. +5% Power.", () => state.tech.interns++);
        createTech(cont, "QUANTUM TAX EVASION", 15000 * Math.pow(5, state.tech.tax), "Ignoring IRS laws of physics. +10% Cash.", () => state.tech.tax++);
        createTech(cont, "SOOT GREENWASHING", 8000 * Math.pow(2, state.tech.greenwash), "Smoke is just 'artistic clouds'. +5% Cash.", () => state.tech.greenwash++);
        
        if (state.tier >= 3) {
            createTech(cont, "SPAGHETTIFICATION INSURANCE", 500000000 * Math.pow(10, state.tech.spag), "Liability protection for void workers. +20% Power.", () => state.tech.spag++);
        }
    }

    function createTech(cont, label, cost, sub, action) {
        const div = document.createElement('div'); div.style.marginBottom = "10px";
        const b = document.createElement('button'); b.className = 'pixel-btn'; b.dataset.cost = cost;
        b.disabled = state.money < cost;
        b.innerHTML = `<div style="display:flex; justify-content:space-between"><span>${label}</span> <span>$${format(cost)}</span></div>`;
        b.onclick = () => { if(state.money >= cost) { state.money -= cost; action(); playSound('buy'); renderTech(); }};
        div.appendChild(b);
        const s = document.createElement('span'); s.className = 'funny-sub'; s.innerText = sub;
        div.appendChild(s);
        cont.appendChild(div);
    }

    function upgradeSelected() {
        const data = state.grid[state.selectedIdx];
        const rarityMult = 1.5 + (PLANTS[data.id].rarity / 100);
        const cost = Math.floor(PLANTS[data.id].cost * Math.pow(rarityMult, data.level));
        if(state.money >= cost && data.level < 10) { state.money -= cost; data.level++; playSound('buy'); renderGrid(); updateInspector(); }
    }

    function deconstructSelected() {
        state.money += Math.floor(PLANTS[state.grid[state.selectedIdx].id].cost * 0.4);
        state.grid[state.selectedIdx] = null; playSound('buy'); selectCell(state.selectedIdx); renderGrid();
    }

    function updateUI() { document.body.setAttribute('data-tier', state.tier); document.getElementById('logo').src = `assets/logo${state.tier}.png`; }
    function toggleMute() { state.mute = !state.mute; document.getElementById('mute-toggle').innerText = state.mute ? "ðŸ”‡" : "ðŸ”Š"; if(state.mute) sounds.hum.pause(); }
    function playSound(n) { if(!state.mute) sounds[n].play(); }
</script>
</body>
</html>
